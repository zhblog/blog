---
layout: default
title: Python多进程 
author: zzh 
---
<p id="fortitle"> {{ site.time | date_to_xmlschema }} </p>
由于GIL的原因，Python不支持真正意义上的多线程
于是转而求其次，Python使用多进程来完成并行任务。
Python的<a href='http://docs.python.org/library/multiprocessing.html'>multiprocessing</a>库就是多进程的利器，
它能够像多现成一样的使用多进程,注意 python version 2.6+
能够简单快捷的进行多任务开发。
多进程间共享数据，可以使用 multiprocessing.Value 和 multiprocessing.Array 等
下面<a href='http://docs.python.org/library/multiprocessing.html#exchanging-objects-between-processes'>这里介绍</a>一下共享数据的方式
</pre>
<h2>交换对象</h2>
<h4>Queues</h4>
<pre class="brush: python">
from multiprocessing import Process, Queue

def f(q):
    q.put([42, None, 'hello'])

if __name__ == '__main__':
    q = Queue()
    p = Process(target=f, args=(q,))
    p.start()
    print q.get()    # prints "[42, None, 'hello']"
    p.join()
</pre>
<h4>Pipes</h4>
<pre class="brush: python">
from multiprocessing import Process, Pipe

def f(conn):
    conn.send([42, None, 'hello'])
    conn.close()

if __name__ == '__main__':
    parent_conn, child_conn = Pipe()
    p = Process(target=f, args=(child_conn,))
    p.start()
    print parent_conn.recv()   # prints "[42, None, 'hello']"
    p.join()
</pre>
</br>
<h2>数据共享</h2>
<h4>共享内存</h4>
<pre class="brush: python">
from multiprocessing import Process, Value, Array

def f(n, a):
    n.value = 3.1415927
    for i in range(len(a)):
        a[i] = -a[i]

if __name__ == '__main__':
    num = Value('d', 0.0)
    arr = Array('i', range(10))

    p = Process(target=f, args=(num, arr))
    p.start()
    p.join()

    print num.value
    print arr[:]
</pre>
<p>具体参数含义，看<a href="http://docs.python.org/library/array.html"></a>这里</p>
<h4>Server process</h4>
<pre class="brush: python">
from multiprocessing import Process, Manager

def f(d, l):
    d[1] = '1'
    d['2'] = 2
    d[0.25] = None
    l.reverse()

if __name__ == '__main__':
    manager = Manager()

    d = manager.dict()
    l = manager.list(range(10))

    p = Process(target=f, args=(d, l))
    p.start()
    p.join()

    print d
    print l
</pre>
