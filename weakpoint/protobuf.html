
<!doctype html>  
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PROTOBUF简介</title>
    <link rel="stylesheet" href="/blog/weakpoint/core/weakpoint.css">
    <script src="/blog/weakpoint/third/jquery.js" type="text/javascript"></script>
    <script src="/blog/weakpoint/third/jquery.bxSlider.min.js" type="text/javascript"></script>
    <script type="text/javascript">
  $(document).ready(function(){
    bxslide = $('#slider1').bxSlider({
        infiniteLoop: false,
        controls: false,
        mode: 'horizontal',
        speed: 200,
        onBeforeSlide: function(){onSwitch=true},
        onAfterSlide: function(){onSwitch=false}
        });
});
    </script>
     <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [ ['$','$'], ["\(","\)"] ],processEscapes: true}});</script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']}});</script>
    <script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {var all = MathJax.Hub.getAllJax(), i;for(i=0; i < all.length; i += 1) {all[i].SourceElement().parentNode.className += ' has-jax';}});</script>
    <script type="text/javascript"src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href='http://fonts.googleapis.com/css?family=Eater' rel='stylesheet' type='text/css'>    
    <link rel="stylesheet" href="/blog/weakpoint/theme/clean.css">
    <script type="text/javascript">var _gaq = _gaq || [];_gaq.push(['_setAccount', "UA-33272534-1"]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script>
    
  </head>
<body>
    <div class="navi"><span>Protobug简介</span><span>Protobuf简单使用</span>
    </div>
    <div id="wrapper">
    <div id="slider1">
    <div class="paper"><div class="paper-container">
<!-- ====================front page ===============  -->
<div class="title">PROTOBUF简介</div>
<div class="subtitle">牛X的序列化框架</div>
<div class="meta"><img style="float:left;margin:15px;" class="avatar"src="/blog/weakpoint/img/ubuntu-gril.jpg" alt="avatar" width="180" height="140"/>
<table>
<tbody>
<tr class="author"><td>jack.zh</td></tr>
<tr class="social"><td><ul>
  <li class="email"><a href="mailto:git.zhang@gmail.com" targe="_blank">Email</a></li>
  <li class="sinaweibo"><a href="http://weibo.com/九月张郎" target="_blank">@sina</a></li>
  <li class="github"><a href="http://github.com/zhblog" target="_blank">Github</a></li>
</ul></td></tr>
<tr class="organization"><td>学无止境</td></tr>
<tr class="date"><td>2013-03-05</td></tr>
</tbody>
</table>
</div>
<div class="theme">clean theme</div>
 <!-- ================front page==============  -->
<div id="popup" style="margin-top: 60px;width:380px;height:120px;color: #333;display:none;background-color:#ddd;padding: 20px;border-radius: 15px;">j / k PPT翻页<br>F11 全屏</br>试试看!</div></div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h1>Protobug简介</h1>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>WHAT</h2>
<ul>
<li>google的</li>
<li>开源序的</li>
<li>平台无关、语言无关的</li>
<li>结构化数据的序列化与反序列化 </li>
</ul>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>WHERE</h2>
<ul>
<li><a href="blog.itpub.net/post/42700/527047">官方网站</a> </li>
<li><a href="http://code.google.com/p/protobuf-c/">C语言支持</a></li>
<li><a href="http://code.google.com/p/protobuf/wiki/ThirdPartyAddOns">其他语言列表</a></li>
<li><a href="https://developers.google.com/protocol-buffers/">简介教程</a>  </li>
</ul>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>WHY</h2>
<ul>
<li>语言中立，平台中立，可扩展性好 </li>
<li>性能可靠</li>
<li>使用简单,API相对统一 </li>
<li>相较JSON，XML定义简单，接口统一</li>
</ul>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h1>Protobuf简单使用</h1>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>1. protobuf文件</h2>
<pre><code>message Person {
required string name = 1;
required int32 id = 2;
optional string email = 3;

enum PhoneType {
    MOBILE = 0;
    HOME = 1;
    WORK = 2;
    }

message PhoneNumber {
    required string number = 1;
    optional PhoneType type = 2 [default = HOME];
    }

repeated PhoneNumber phone = 4;
}
</code></pre>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>2. 增加模块</h2>
<ul>
<li>message： 消息定义</li>
<li>Person： 消息名称</li>
<li>enum：枚举类型</li>
<li>required：可选项</li>
<li>optional：必选项</li>
<li>repeated：数组选项</li>
</ul>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>3. 测试用proto</h2>
<pre><code>message AMessage
{
    required int32 a=1; 
    optional int32 b=2;
}
</code></pre>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>4. 编译proto</h2>
<pre><code>#!/usr/bin/bash
file="../file/person.proto"
if [ $# -eq 1 ];
then
    file="../file/$1.proto"
fi
echo $file
protoc --python_out=../python/ --proto_path=../file/ $file
protoc-c --c_out=../c/ --proto_path=../file $file
</code></pre>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>5. C语言打包程序</h2>
<pre><code>static void* packbuf()
{
    AMessage msg = AMESSAGE__INIT; // AMessage
    void *buf;                     // Buffer to store serialized data
    unsigned len;                  // Length of serialized data
    msg.a = 1;
    //msg.has_b = 1; 
    msg.b = 2;
    len = amessage__get_packed_size(&amp;msg);

    buf = malloc(len);
    amessage__pack(&amp;msg,buf);
    return buf;
}
</code></pre>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>6. 编译C的makefile</h2>
<pre><code>all = client 
CC=clang
objs = amessage.pb-c.o   
CFLAGS = -Wall 
$(all): test.c $(objs)
    clang -I. -o $@ $^ -lprotobuf-c -lzmq
clean:
    $(RM) *.o
    $(RM) $(all)
    $(RM) *~
</code></pre>

    <!-- ====================================================== -->
    </div></div>






    
    
    <div class="paper"><div class="paper-container">
    <!-- =========================SLIDE==========================-->
    
<h2>7. Python解包</h2>
<pre><code>print "Received request: ", len(buf)
print repr(buf)
APB.AMessage.ParseFromString(am, buf)
print am.a
print am.b
</code></pre>
    <!-- ====================================================== -->
    </div></div>
    <div class="paper"><div class="paper-container">
      <div class="thanks">Thanks!</div></div>
    </div>
    </div>
    </div>
    <script type="text/javascript" src="/blog/weakpoint/core/weakpoint.js"></script>
    <script type="text/javascript">var weakpoint = new weakPoint(); weakpoint.init();</script>
    <a href="https://github.com/zhblog"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/blog/img/f.png" alt="Fork me on GitHub"></a>
    </body>
</html>